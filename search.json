[{"title":"当在 Kubernetes 中增加 MySQL 副本时，第二个副本启动报错","path":"/2024/05/14/post/","content":"问题描述：当在 Kubernetes 中增加 MySQL StatefulSet 副本时，第二个副本启动报错 [ERROR] [MY-012574] [InnoDB] Unable to lock ./ibdata1 error: 11 这通常是由于多个副本尝试使用相同的持久卷（Persistent Volume）引起的。要解决这个问题，确保每个副本有独立的持久卷是关键。 确保 StatefulSet 使用 volumeClaimTemplates 为每个副本创建独立的 PVC。注意：volumeClaimTemplates只有在有状态副本集下才有效，下面是具体步骤 1. 确认 StatefulSet 配置以下是一个正确配置的 StatefulSet 示例，它确保每个副本有独立的持久卷： 1234567891011121314151617181920212223242526272829303132333435apiVersion: apps/v1kind: StatefulSetmetadata: name: mysqlspec: serviceName: &quot;mysql&quot; replicas: 2 # 可以设置为需要的副本数 selector: matchLabels: app: mysql template: metadata: labels: app: mysql spec: containers: - name: mysql image: mysql:8.0 ports: - containerPort: 3306 volumeMounts: - name: mysql-persistent-storage mountPath: /var/lib/mysql env: - name: MYSQL_ROOT_PASSWORD value: &quot;your_password&quot; volumeClaimTemplates: - metadata: name: mysql-persistent-storage spec: accessModes: [ &quot;ReadWriteOnce&quot; ] resources: requests: storage: 10Gi 2. 应用 StatefulSet将上述配置保存为 mysql-statefulset.yaml 文件，然后应用： 1kubectl apply -f mysql-statefulset.yaml 3. 验证 PVC 和 PV确保每个 Pod 具有独立的 PVC： 1kubectl get pvc 输出应显示每个 MySQL Pod 都有一个对应的 PVC，状态应为 Bound。 4.kubesphere中如何应用在”应用负载”–&gt;”工作负载”中创建有状态副本集，在“挂载储存”步骤中，添加储存卷模板即可 详见持久卷声明 (kubesphere.io) 5.另附小知识点OOMKill 是 Linux 系统中的一种机制，用来在系统内存耗尽时，终止一些进程以释放内存。这种机制由 Linux 内核的 OOM Killer (Out-Of-Memory Killer) 负责。当系统内存使用量达到临界点时，OOM Killer 会选择一个或多个进程进行终止，以便释放内存资源，确保系统继续运行。 在 Kubernetes 环境中，当某个容器（Pod）占用了超过其限制的内存时，也可能会触发 OOMKill。这通常意味着你的应用程序需要的内存超过了你在 Pod 的资源限制中设置的上限。","tags":["kubernetes","mysql"],"categories":["kubernetes"]},{"title":"关于卷组（vg）拓展逻辑卷（lv）中有无“+”的影响","path":"/2024/05/11/post/","content":"如下命令表示将lv拓展大小至1G 1lvextend -L 1G /dev/vgtest/lvtest 如下命令表示增加1G大小给lv 1lvextend -L +1G /dev/vgtest/lvtest","tags":["lvs","扩容"],"categories":["linux"]},{"title":"Hello World","path":"/2024/05/04/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment"},{"title":"链接","path":"/link/index.html","content":"你好世界"}]